<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/html40/loose.dtd">
<HTML>
<!-- Created on June, 7 2005 by texi2html 1.66 -->
<!--
Written by: Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Many creative people <dev@texi2html.cvshome.org>
Send bugs and suggestions to <users@texi2html.cvshome.org>

-->
<HEAD>
<TITLE>The `GnuPG Made Easy' Reference Manual: Encrypting a Plaintext</TITLE>

<META NAME="description" CONTENT="The `GnuPG Made Easy' Reference Manual: Encrypting a Plaintext">
<META NAME="keywords" CONTENT="The `GnuPG Made Easy' Reference Manual: Encrypting a Plaintext">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META NAME="Generator" CONTENT="texi2html 1.66">

</HEAD>

<BODY LANG="en" BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">

<A NAME="SEC67"></A>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="gpgme_66.html#SEC66"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="gpgme_68.html#SEC68"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="gpgme_34.html#SEC34"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="gpgme_66.html#SEC66"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="gpgme_78.html#SEC78"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="gpgme.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="gpgme_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="gpgme_81.html#SEC81">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="gpgme_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<HR SIZE=1>
<H4> 7.6.5.1 Encrypting a Plaintext </H4>
<!--docid::SEC67::-->
<P>

<A NAME="IDX157"></A>
</P>
<DL>
<DT><U>Function:</U> gpgme_error_t <B>gpgme_op_encrypt</B> <I>(gpgme_ctx_t <VAR>ctx</VAR>, gpgme_key_t <VAR>recp</VAR>[], gpgme_encrypt_flags_t <VAR>flags</VAR>, gpgme_data_t <VAR>plain</VAR>, gpgme_data_t <VAR>cipher</VAR>)</I>
<DD>The function <CODE>gpgme_op_encrypt</CODE> encrypts the plaintext in the data
object <VAR>plain</VAR> for the recipients <VAR>recp</VAR> and stores the
ciphertext in the data object <VAR>cipher</VAR>.  The type of the
ciphertext created is determined by the <FONT SIZE="-1">ASCII</FONT> armor and text
mode attributes set for the context <VAR>ctx</VAR>.
<P>

<VAR>key</VAR> must be a <CODE>NULL</CODE>-terminated array of keys.  The user
must keep references for all keys during the whole duration of the
call (but see <CODE>gpgme_op_encrypt_start</CODE> for the requirements with
the asynchronous variant).
</P>
<P>

The value in <VAR>flags</VAR> is a bitwise-or combination of one or
multiple of the following bit values:
</P>
<P>

</P>
<DL COMPACT>
<DT><CODE>GPGME_ENCRYPT_ALWAYS_TRUST</CODE>
<DD>The <CODE>GPGME_ENCRYPT_ALWAYS_TRUST</CODE> symbol specifies that all the
recipients in <VAR>recp</VAR> should be trusted, even if the keys do not
have a high enough validity in the keyring.  This flag should be used
with care; in general it is not a good idea to use any untrusted keys.
</DL>
<P>

If <CODE>GPG_ERR_UNUSABLE_PUBKEY</CODE> is returned, some recipients in
<VAR>recp</VAR> are invalid, but not all.  In this case the plaintext might
be encrypted for all valid recipients and returned in <VAR>cipher</VAR> (if
this happens depends on the crypto engine).  More information about
the invalid recipients is available with
<CODE>gpgme_op_encrypt_result</CODE>.
</P>
<P>

If <VAR>recp</VAR> is <CODE>NULL</CODE>, symmetric rather than public key
encryption is performed.  Symmetrically encrypted cipher text can be
deciphered with <CODE>gpgme_op_decrypt</CODE>.  Note that in this case the
crypto backend needs to retrieve a passphrase from the user.
Symmetric encryption is currently only supported for the OpenPGP
crypto backend.
</P>
<P>

The function returns the error code <CODE>GPG_ERR_NO_ERROR</CODE> if the
ciphertext could be created successfully, <CODE>GPG_ERR_INV_VALUE</CODE> if
<VAR>ctx</VAR>, <VAR>recp</VAR>, <VAR>plain</VAR> or <VAR>cipher</VAR> is not a valid
pointer, <CODE>GPG_ERR_UNUSABLE_PUBKEY</CODE> if <VAR>recp</VAR> contains some
invalid recipients, <CODE>GPG_ERR_BAD_PASSPHRASE</CODE> if the passphrase
for the symmetric key could not be retrieved, and passes through any
errors that are reported by the crypto engine support routines.
</P>
</DL>
<P>

<A NAME="IDX158"></A>
</P>
<DL>
<DT><U>Function:</U> gpgme_error_t <B>gpgme_op_encrypt_start</B> <I>(gpgme_ctx_t <VAR>ctx</VAR>, gpgme_key_t <VAR>recp</VAR>[], gpgme_encrypt_flags_t <VAR>flags</VAR>, gpgme_data_t <VAR>plain</VAR>, gpgme_data_t <VAR>cipher</VAR>)</I>
<DD>The function <CODE>gpgme_op_encrypt_start</CODE> initiates a
<CODE>gpgme_op_encrypt</CODE> operation.  It can be completed by calling
<CODE>gpgme_wait</CODE> on the context.  See section <A HREF="gpgme_69.html#SEC69">7.7.1 Waiting For Completion</A>.
<P>

References to the keys only need to be held for the duration of this
call.  The user can release its references to the keys after this
function returns, even if the operation is not yet finished.
</P>
<P>

The function returns the error code <CODE>GPG_ERR_NO_ERROR</CODE> if the
operation could be started successfully, <CODE>GPG_ERR_INV_VALUE</CODE> if
<VAR>ctx</VAR>, <VAR>rset</VAR>, <VAR>plain</VAR> or <VAR>cipher</VAR> is not a valid
pointer, and <CODE>GPG_ERR_UNUSABLE_PUBKEY</CODE> if <VAR>rset</VAR> does not
contain any valid recipients.
</P>
</DL>
<P>

<A NAME="IDX159"></A>
</P>
<DL>
<DT><U>Data type:</U> <B>gpgme_encrypt_result_t</B>
<DD>This is a pointer to a structure used to store the result of a
<CODE>gpgme_op_encrypt</CODE> operation.  After successfully encrypting
data, you can retrieve the pointer to the result with
<CODE>gpgme_op_encrypt_result</CODE>.  The structure contains the following
members:
<P>

</P>
<DL COMPACT>
<DT><CODE>gpgme_invalid_key_t invalid_recipients</CODE>
<DD>A linked list with information about all invalid keys for which
the data could not be encrypted.
</DL>
</DL>
<P>

<A NAME="IDX160"></A>
</P>
<DL>
<DT><U>Function:</U> gpgme_encrypt_result_t <B>gpgme_op_encrypt_result</B> <I>(gpgme_ctx_t <VAR>ctx</VAR>)</I>
<DD>The function <CODE>gpgme_op_encrypt_result</CODE> returns a
<CODE>gpgme_encrypt_result_t</CODE> pointer to a structure holding the
result of a <CODE>gpgme_op_encrypt</CODE> operation.  The pointer is only
valid if the last operation on the context was a
<CODE>gpgme_op_encrypt</CODE>, <CODE>gpgme_op_encrypt_start</CODE>,
<CODE>gpgme_op_sign</CODE> or <CODE>gpgme_op_sign_start</CODE> operation.  If this
operation failed, this might be a <CODE>NULL</CODE> pointer.  The returned
pointer is only valid until the next operation is started on the
context.
</DL>
<P>

<A NAME="IDX161"></A>
</P>
<DL>
<DT><U>Function:</U> gpgme_error_t <B>gpgme_op_encrypt_sign</B> <I>(gpgme_ctx_t <VAR>ctx</VAR>, gpgme_key_t <VAR>recp</VAR>[], gpgme_encrypt_flags_t <VAR>flags</VAR>, gpgme_data_t <VAR>plain</VAR>, gpgme_data_t <VAR>cipher</VAR>)</I>
<DD>The function <CODE>gpgme_op_encrypt_sign</CODE> does a combined encrypt and
sign operation.  It is used like <CODE>gpgme_op_encrypt</CODE>, but the
ciphertext also contains signatures for the signers listed in
<VAR>ctx</VAR>.
<P>

The combined encrypt and sign operation is currently only available
for the OpenPGP crypto engine.
</P>
</DL>
<P>

<A NAME="IDX162"></A>
</P>
<DL>
<DT><U>Function:</U> gpgme_error_t <B>gpgme_op_encrypt_sign_start</B> <I>(gpgme_ctx_t <VAR>ctx</VAR>, gpgme_key_t <VAR>recp</VAR>, gpgme_encrypt_flags_t <VAR>flags</VAR>, gpgme_data_t <VAR>plain</VAR>, gpgme_data_t <VAR>cipher</VAR>)</I>
<DD>The function <CODE>gpgme_op_encrypt_sign_start</CODE> initiates a
<CODE>gpgme_op_encrypt_sign</CODE> operation.  It can be completed by
calling <CODE>gpgme_wait</CODE> on the context.  See section <A HREF="gpgme_69.html#SEC69">7.7.1 Waiting For Completion</A>.
<P>

The function returns the error code <CODE>GPG_ERR_NO_ERROR</CODE> if the
operation could be started successfully, and <CODE>GPG_ERR_INV_VALUE</CODE>
if <VAR>ctx</VAR>, <VAR>rset</VAR>, <VAR>plain</VAR> or <VAR>cipher</VAR> is not a valid
pointer.
</P>
</DL>
<P>

<A NAME="Run Control"></A>
<HR SIZE=1>
<TABLE CELLPADDING=1 CELLSPACING=1 BORDER=0>
<TR><TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="gpgme_66.html#SEC66"> &lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="gpgme_68.html#SEC68"> &gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="gpgme_34.html#SEC34"> &lt;&lt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="gpgme_66.html#SEC66"> Up </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="gpgme_78.html#SEC78"> &gt;&gt; </A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT"> &nbsp; <TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="gpgme.html#SEC_Top">Top</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="gpgme_toc.html#SEC_Contents">Contents</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="gpgme_81.html#SEC81">Index</A>]</TD>
<TD VALIGN="MIDDLE" ALIGN="LEFT">[<A HREF="gpgme_abt.html#SEC_About"> ? </A>]</TD>
</TR></TABLE>
<BR>
<FONT SIZE="-1">
This document was generated
by <I>Igor Belyi</I> on <I>June, 7 2005</I>
using <A HREF="http://texi2html.cvshome.org"><I>texi2html</I></A>
</FONT>

</BODY>
</HTML>
