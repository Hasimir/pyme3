<html lang="en">
<head>
<title>Callback Based Data Buffers - The `GnuPG Made Easy' Reference Manual</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="The `GnuPG Made Easy' Reference Manual">
<meta name="generator" content="makeinfo 4.11">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Creating-Data-Buffers.html#Creating-Data-Buffers" title="Creating Data Buffers">
<link rel="prev" href="File-Based-Data-Buffers.html#File-Based-Data-Buffers" title="File Based Data Buffers">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<p>
<a name="Callback-Based-Data-Buffers"></a>
Previous:&nbsp;<a rel="previous" accesskey="p" href="File-Based-Data-Buffers.html#File-Based-Data-Buffers">File Based Data Buffers</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Creating-Data-Buffers.html#Creating-Data-Buffers">Creating Data Buffers</a>
<hr>
</div>

<h4 class="subsection">6.1.3 Callback Based Data Buffers</h4>

<p>If neither memory nor file based data objects are a good fit for your
application, you can implement the functions a data object provides
yourself and create a data object from these callback functions.

<div class="defun">
&mdash; Data type: <b>ssize_t (*gpgme_data_read_cb_t) (void&nbsp;*</b><var>handle</var><b><!-- /@w -->, void&nbsp;</b><var>*buffer</var><b><!-- /@w -->, size_t&nbsp;</b><var>size</var><b><!-- /@w -->)</b><var><a name="index-ssize_005ft-_0028_002agpgme_005fdata_005fread_005fcb_005ft_0029-_0028_0040w_007bvoid-_002a_0040var_007bhandle_007d_007d_002c-_0040w_007bvoid-_0040var_007b_002abuffer_007d_007d_002c-_0040w_007bsize_005ft-_0040var_007bsize_007d_007d_0029-93"></a></var><br>
<blockquote><p><a name="index-gpgme_005fdata_005fread_005fcb_005ft-94"></a>The <code>gpgme_data_read_cb_t</code> type is the type of functions which
<acronym>GPGME</acronym> calls if it wants to read data from a user-implemented
data object.  The function should read up to <var>size</var> bytes from the
current read position into the space starting at <var>buffer</var>.  The
<var>handle</var> is provided by the user at data object creation time.

        <p>The function should return the number of bytes read, 0 on EOF, and -1
on error.  If an error occurs, <var>errno</var> should be set to describe
the type of the error. 
</p></blockquote></div>

<div class="defun">
&mdash; Data type: <b>ssize_t (*gpgme_data_write_cb_t) (void&nbsp;*</b><var>handle</var><b><!-- /@w -->, const&nbsp;void&nbsp;</b><var>*buffer</var><b><!-- /@w -->, size_t&nbsp;</b><var>size</var><b><!-- /@w -->)</b><var><a name="index-ssize_005ft-_0028_002agpgme_005fdata_005fwrite_005fcb_005ft_0029-_0028_0040w_007bvoid-_002a_0040var_007bhandle_007d_007d_002c-_0040w_007bconst-void-_0040var_007b_002abuffer_007d_007d_002c-_0040w_007bsize_005ft-_0040var_007bsize_007d_007d_0029-95"></a></var><br>
<blockquote><p><a name="index-gpgme_005fdata_005fwrite_005fcb_005ft-96"></a>The <code>gpgme_data_write_cb_t</code> type is the type of functions which
<acronym>GPGME</acronym> calls if it wants to write data to a user-implemented
data object.  The function should write up to <var>size</var> bytes to the
current write position from the space starting at <var>buffer</var>.  The
<var>handle</var> is provided by the user at data object creation time.

        <p>The function should return the number of bytes written, and -1 on
error.  If an error occurs, <var>errno</var> should be set to describe the
type of the error. 
</p></blockquote></div>

<div class="defun">
&mdash; Data type: <b>off_t (*gpgme_data_seek_cb_t) (void&nbsp;*</b><var>handle</var><b><!-- /@w -->, off_t&nbsp;</b><var>offset</var><b><!-- /@w -->, int&nbsp;</b><var>whence</var><b><!-- /@w -->)</b><var><a name="index-off_005ft-_0028_002agpgme_005fdata_005fseek_005fcb_005ft_0029-_0028_0040w_007bvoid-_002a_0040var_007bhandle_007d_007d_002c-_0040w_007boff_005ft-_0040var_007boffset_007d_007d_002c-_0040w_007bint-_0040var_007bwhence_007d_007d_0029-97"></a></var><br>
<blockquote><p><a name="index-gpgme_005fdata_005fseek_005fcb_005ft-98"></a>The <code>gpgme_data_seek_cb_t</code> type is the type of functions which
<acronym>GPGME</acronym> calls if it wants to change the current read/write
position in a user-implemented data object, just like the <code>lseek</code>
function.

        <p>The function should return the new read/write position, and -1 on
error.  If an error occurs, <var>errno</var> should be set to describe the
type of the error. 
</p></blockquote></div>

<div class="defun">
&mdash; Data type: <b>void (*gpgme_data_release_cb_t) (void&nbsp;*</b><var>handle</var><b><!-- /@w -->)</b><var><a name="index-void-_0028_002agpgme_005fdata_005frelease_005fcb_005ft_0029-_0028_0040w_007bvoid-_002a_0040var_007bhandle_007d_007d_0029-99"></a></var><br>
<blockquote><p><a name="index-gpgme_005fdata_005frelease_005fcb_005ft-100"></a>The <code>gpgme_data_release_cb_t</code> type is the type of functions which
<acronym>GPGME</acronym> calls if it wants to destroy a user-implemented data
object.  The <var>handle</var> is provided by the user at data object
creation time. 
</p></blockquote></div>

<div class="defun">
&mdash; Data type: <b>struct gpgme_data_cbs</b><var><a name="index-struct-gpgme_005fdata_005fcbs-101"></a></var><br>
<blockquote><p>This structure is used to store the data callback interface functions
described above.  It has the following members:

          <dl>
<dt><code>gpgme_data_read_cb_t read</code><dd>This is the function called by <acronym>GPGME</acronym> to read data from the
data object.  It is only required for input data object.

          <br><dt><code>gpgme_data_write_cb_t write</code><dd>This is the function called by <acronym>GPGME</acronym> to write data to the
data object.  It is only required for output data object.

          <br><dt><code>gpgme_data_seek_cb_t seek</code><dd>This is the function called by <acronym>GPGME</acronym> to change the current
read/write pointer in the data object (if available).  It is optional.

          <br><dt><code>gpgme_data_release_cb_t release</code><dd>This is the function called by <acronym>GPGME</acronym> to release a data
object.  It is optional. 
</dl>
        </p></blockquote></div>

<div class="defun">
&mdash; Function: gpgme_error_t <b>gpgme_data_new_from_cbs</b> (<var>gpgme_data_t&nbsp;*dh<!-- /@w -->, gpgme_data_cbs_t&nbsp;cbs<!-- /@w -->, void&nbsp;*handle<!-- /@w --></var>)<var><a name="index-gpgme_005fdata_005fnew_005ffrom_005fcbs-102"></a></var><br>
<blockquote><p>The function <code>gpgme_data_new_from_cbs</code> creates a new
<code>gpgme_data_t</code> object and uses the user-provided callback functions
to operate on the data object.

        <p>The handle <var>handle</var> is passed as first argument to the callback
functions.  This can be used to identify this data object.

        <p>The function returns the error code <code>GPG_ERR_NO_ERROR</code> if the
data object was successfully created, and <code>GPG_ERR_ENOMEM</code> if not
enough memory is available. 
</p></blockquote></div>

   <p>The following interface is deprecated and only provided for backward
compatibility.  Don't use it.  It will be removed in a future version
of <acronym>GPGME</acronym>.

<div class="defun">
&mdash; Function: gpgme_error_t <b>gpgme_data_new_with_read_cb</b> (<var>gpgme_data_t&nbsp;*dh<!-- /@w -->, int&nbsp;(*readfunc)<!-- /@w --> </var>(<var>void&nbsp;*hook<!-- /@w -->, char&nbsp;*buffer<!-- /@w -->, size_t&nbsp;count<!-- /@w -->, size_t&nbsp;*nread<!-- /@w --></var>)<var>, void&nbsp;*hook_value<!-- /@w --></var>)<var><a name="index-gpgme_005fdata_005fnew_005fwith_005fread_005fcb-103"></a></var><br>
<blockquote><p>The function <code>gpgme_data_new_with_read_cb</code> creates a new
<code>gpgme_data_t</code> object and uses the callback function <var>readfunc</var>
to retrieve the data on demand.  As the callback function can supply
the data in any way it wants, this is the most flexible data type
<acronym>GPGME</acronym> provides.  However, it can not be used to write data.

        <p>The callback function receives <var>hook_value</var> as its first argument
whenever it is invoked.  It should return up to <var>count</var> bytes in
<var>buffer</var>, and return the number of bytes actually read in
<var>nread</var>.  It may return <code>0</code> in <var>nread</var> if no data is
currently available.  To indicate <code>EOF</code> the function should
return with an error code of <code>-1</code> and set <var>nread</var> to
<code>0</code>.  The callback function may support to reset its internal
read pointer if it is invoked with <var>buffer</var> and <var>nread</var> being
<code>NULL</code> and <var>count</var> being <code>0</code>.

        <p>The function returns the error code <code>GPG_ERR_NO_ERROR</code> if the
data object was successfully created, <code>GPG_ERR_INV_VALUE</code> if
<var>dh</var> or <var>readfunc</var> is not a valid pointer, and
<code>GPG_ERR_ENOMEM</code> if not enough memory is available. 
</p></blockquote></div>

   </body></html>

